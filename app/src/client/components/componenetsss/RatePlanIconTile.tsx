// RatePlanIconTile.tsx
import * as React from "react";
import "./RatePlanIconTile.css";

export type RatePlanIconType =
  | "STAIRSTEP"
  | "FLAT_FEE"
  | "TIERED"
  | "USAGE_BASED"
  | "VOLUME_BASED";

type Theme = {
  /** main strong color (ex: #2A559C) */
  accent: string;
  /** soft color used in icon strokes + gradient (ex: #ADC5EB) */
  soft: string;

  /** pill bg alpha (0..1). default 0.14 */
  pillBgAlpha?: number;
  /** pill text/icon color. default = accent */
  pillFg?: string;

  /** tile surface background. default matches your screenshot */
  tileBg?: string;
};

type Props = {
  type: RatePlanIconType;

  /** bottom pill text (ex: "IPP") */
  tagText?: string;

  /** size of the whole tile */
  size?: number;

  /** theme colors */
  theme: Theme;

  className?: string;
};

function clamp(n: number, min: number, max: number) {
  return Math.max(min, Math.min(max, n));
}

function hexToRgba(hex: string, alpha: number) {
  const a = clamp(alpha, 0, 1);
  const clean = hex.replace("#", "").trim();
  const full = clean.length === 3 ? clean.split("").map((c) => c + c).join("") : clean;
  const n = parseInt(full, 16);
  const r = (n >> 16) & 255;
  const g = (n >> 8) & 255;
  const b = n & 255;
  return `rgba(${r}, ${g}, ${b}, ${a})`;
}

function hexToRgb(hex: string) {
  const clean = hex.replace("#", "").trim();
  const full = clean.length === 3 ? clean.split("").map((c) => c + c).join("") : clean;
  const n = parseInt(full, 16);
  const r = (n >> 16) & 255;
  const g = (n >> 8) & 255;
  const b = n & 255;
  return `${r}, ${g}, ${b}`;
}

/** 8x8 tag icon (your SVG) but color becomes dynamic via currentColor */
function TagIcon8() {
  return (
    <svg className="rpPillTagIcon" xmlns="http://www.w3.org/2000/svg" width="8" height="8" viewBox="0 0 8 8" fill="none">
      <path
        d="M3.74795 0.702293C3.87739 0.572805 4.05298 0.500039 4.23607 0.5L6.71192 0.5C6.89503 0.5 7.07065 0.572741 7.20012 0.70222C7.3296 0.831699 7.40234 1.00731 7.40234 1.19042V3.66627C7.4023 3.84937 7.32954 4.02495 7.20005 4.1544L4.19534 7.15911C4.03844 7.31502 3.82622 7.40253 3.60503 7.40253C3.38383 7.40253 3.17162 7.31502 3.01472 7.15911L0.743234 4.88762C0.587322 4.73072 0.499815 4.51851 0.499815 4.29731C0.499815 4.07612 0.587322 3.86391 0.743234 3.70701L3.74795 0.702293Z"
        stroke="currentColor"
        strokeWidth="0.99995"
        strokeLinecap="round"
        strokeLinejoin="round"
      />
    </svg>
  );
}

/** Shared helper: Angular(conic) gradient block exactly like Figma export, but with dynamic colors */
function AngularFillBlock({
  accent,
  soft,
  stopDeg = 242.437,
  softAlpha = 0.3,
}: {
  accent: string;
  soft: string;
  stopDeg?: number;
  softAlpha?: number;
}) {
  const softRgba = hexToRgba(soft, softAlpha);
  const bg = `conic-gradient(from 90deg, ${softRgba} 0deg, ${accent} ${stopDeg}deg, ${softRgba} 360deg)`;
  return (
    <foreignObject x="-5958.13" y="-5958.13" width="11916.3" height="11916.3">
      <div
        style={{
          background: bg,
          height: "100%",
          width: "100%",
          opacity: 1,
        }}
      />
    </foreignObject>
  );
}

/** ================= ICONS (exact shapes you pasted, only colors made dynamic) ================= */

function StairStepIcon({ accent, soft }: { accent: string; soft: string }) {
  const rid = React.useId();
  const clip0 = `rp-stair-clip0-${rid}`;

  return (
    <svg className="rpTopIcon" xmlns="http://www.w3.org/2000/svg" width="26" height="19" viewBox="0 0 26 19" fill="none">
      <g clipPath={`url(#${clip0})`} data-figma-skip-parse="true">
        <g transform="matrix(0.0045 0.001 -0.000918782 0.00413452 -0.372559 19.6666)">
          <AngularFillBlock accent={accent} soft={soft} />
        </g>
      </g>

      <path
        d="M10.6235 11.9961H12.6275C12.8608 11.9961 13.0563 11.9171 13.2141 11.7592C13.372 11.6014 13.451 11.4059 13.451 11.1725V8.3451H15.4549C15.6882 8.3451 15.8838 8.26613 16.0415 8.1082C16.1995 7.95044 16.2784 7.7549 16.2784 7.52157V4.66667H18.1176C18.351 4.66667 18.5465 4.5877 18.7043 4.42976C18.8622 4.27183 18.9412 4.0762 18.9412 3.84286C18.9412 3.60935 18.8622 3.4138 18.7043 3.25623C18.5465 3.09848 18.351 3.01961 18.1176 3.01961H15.4549C15.2216 3.01961 15.026 3.09858 14.8683 3.25651C14.7103 3.41426 14.6314 3.6098 14.6314 3.84314V6.67059H12.6275C12.3941 6.67059 12.1986 6.74956 12.0408 6.90749C11.8829 7.06524 11.8039 7.26078 11.8039 7.49412V10.3216H9.8C9.56667 10.3216 9.37113 10.4005 9.21337 10.5585C9.05544 10.7162 8.97647 10.9118 8.97647 11.1451V14H7.13726C6.90392 14 6.70838 14.079 6.55063 14.2369C6.39269 14.3948 6.31373 14.5905 6.31373 14.8238C6.31373 15.0573 6.39269 15.2529 6.55063 15.4104C6.70838 15.5682 6.90392 15.6471 7.13726 15.6471H9.8C10.0333 15.6471 10.2289 15.5681 10.3866 15.4102C10.5446 15.2524 10.6235 15.0569 10.6235 14.8235V11.9961ZM1.98498 18.6667C1.43029 18.6667 0.960784 18.4745 0.576471 18.0902C0.192157 17.7059 0 17.2364 0 16.6817V1.98498C0 1.43029 0.192157 0.960784 0.576471 0.576471C0.960784 0.192157 1.43029 0 1.98498 0H23.2699C23.8246 0 24.2941 0.192157 24.6784 0.576471C25.0627 0.960784 25.2549 1.43029 25.2549 1.98498V16.6817C25.2549 17.2364 25.0627 17.7059 24.6784 18.0902C24.2941 18.4745 23.8246 18.6667 23.2699 18.6667H1.98498Z"
        fill="url(#none)" // keep fill from figma block (clipped foreignObject)
      />

      <path
        d="M1.98535 0.200195H23.2695C23.7724 0.200195 24.1912 0.371831 24.5371 0.717773C24.8831 1.06372 25.0547 1.48248 25.0547 1.98535V16.6816C25.0547 17.1845 24.8831 17.6033 24.5371 17.9492C24.1912 18.2951 23.7723 18.4668 23.2695 18.4668H1.98535C1.48256 18.4668 1.06369 18.2951 0.717773 17.9492C0.371824 17.6033 0.200195 17.1845 0.200195 16.6816V1.98535C0.200195 1.48248 0.371824 1.06372 0.717773 0.717773C1.06372 0.371824 1.48248 0.200195 1.98535 0.200195Z"
        stroke={soft}
        strokeOpacity="0.3"
        strokeWidth="0.4"
      />

      <defs>
        <clipPath id={clip0}>
          <path d="M10.6235 11.9961H12.6275C12.8608 11.9961 13.0563 11.9171 13.2141 11.7592C13.372 11.6014 13.451 11.4059 13.451 11.1725V8.3451H15.4549C15.6882 8.3451 15.8838 8.26613 16.0415 8.1082C16.1995 7.95044 16.2784 7.7549 16.2784 7.52157V4.66667H18.1176C18.351 4.66667 18.5465 4.5877 18.7043 4.42976C18.8622 4.27183 18.9412 4.0762 18.9412 3.84286C18.9412 3.60935 18.8622 3.4138 18.7043 3.25623C18.5465 3.09848 18.351 3.01961 18.1176 3.01961H15.4549C15.2216 3.01961 15.026 3.09858 14.8683 3.25651C14.7103 3.41426 14.6314 3.6098 14.6314 3.84314V6.67059H12.6275C12.3941 6.67059 12.1986 6.74956 12.0408 6.90749C11.8829 7.06524 11.8039 7.26078 11.8039 7.49412V10.3216H9.8C9.56667 10.3216 9.37113 10.4005 9.21337 10.5585C9.05544 10.7162 8.97647 10.9118 8.97647 11.1451V14H7.13726C6.90392 14 6.70838 14.079 6.55063 14.2369C6.39269 14.3948 6.31373 14.5905 6.31373 14.8238C6.31373 15.0573 6.39269 15.2529 6.55063 15.4104C6.70838 15.5682 6.90392 15.6471 7.13726 15.6471H9.8C10.0333 15.6471 10.2289 15.5681 10.3866 15.4102C10.5446 15.2524 10.6235 15.0569 10.6235 14.8235V11.9961ZM1.98498 18.6667C1.43029 18.6667 0.960784 18.4745 0.576471 18.0902C0.192157 17.7059 0 17.2364 0 16.6817V1.98498C0 1.43029 0.192157 0.960784 0.576471 0.576471C0.960784 0.192157 1.43029 0 1.98498 0H23.2699C23.8246 0 24.2941 0.192157 24.6784 0.576471C25.0627 0.960784 25.2549 1.43029 25.2549 1.98498V16.6817C25.2549 17.2364 25.0627 17.7059 24.6784 18.0902C24.2941 18.4745 23.8246 18.6667 23.2699 18.6667H1.98498Z" />
        </clipPath>
      </defs>
    </svg>
  );
}

// ✅ Flat fee, Tiered, Usage-based, Volume-based: same idea (your exact SVGs), colors made dynamic.
// To keep this message readable, I’m keeping the remaining 4 icons in a compact form below (still copy-paste ready).

function FlatFeeIcon({ accent, soft }: { accent: string; soft: string }) {
  const rid = React.useId();
  const clip0 = `rp-flat-clip0-${rid}`;
  return (
    <svg className="rpTopIcon" xmlns="http://www.w3.org/2000/svg" width="30" height="19" viewBox="0 0 30 19" fill="none">
      <g clipPath={`url(#${clip0})`} data-figma-skip-parse="true">
        <g transform="matrix(0.00522671 0.001 -0.00106716 0.00413452 -0.432724 19.6666)">
          <foreignObject x="-5955.28" y="-5955.28" width="11910.6" height="11910.6">
            <div
              style={{
                background: `conic-gradient(from 90deg, ${hexToRgba(soft, 0.3)} 0deg, ${accent} 242.437deg, ${hexToRgba(soft, 0.3)} 360deg)`,
                height: "100%",
                width: "100%",
                opacity: 1,
              }}
            />
          </foreignObject>
        </g>
      </g>

      <path
        d="M14.3333 14.6667H15.3V13.6C15.9222 13.5111 16.45 13.2556 16.8833 12.8333C17.3167 12.4111 17.5333 11.8667 17.5333 11.2C17.5333 10.6222 17.3111 10.1389 16.8667 9.75C16.4222 9.36111 15.9111 9.04444 15.3333 8.8V6.33333C15.5556 6.4 15.7389 6.51111 15.8833 6.66667C16.0278 6.82222 16.1333 7.01111 16.2 7.23333L17.4 6.73333C17.2444 6.26667 16.9778 5.89444 16.6 5.61667C16.2222 5.33889 15.8 5.15556 15.3333 5.06667V4H14.3333V5.03333C13.7111 5.1 13.1833 5.32778 12.75 5.71667C12.3167 6.10556 12.1 6.62222 12.1 7.26667C12.1 7.86667 12.3278 8.36667 12.7833 8.76667C13.2389 9.16667 13.7556 9.48889 14.3333 9.73333V12.3667C13.9778 12.2556 13.6778 12.0667 13.4333 11.8C13.1889 11.5333 13.0222 11.2222 12.9333 10.8667L11.7667 11.3667C11.9444 11.9889 12.2556 12.5 12.7 12.9C13.1444 13.3 13.6889 13.5444 14.3333 13.6333V14.6667ZM15.3333 12.3333V10.1333C15.5778 10.2444 15.7944 10.3778 15.9833 10.5333C16.1722 10.6889 16.2667 10.9222 16.2667 11.2333C16.2667 11.5889 16.1778 11.8389 16 11.9833C15.8222 12.1278 15.6 12.2444 15.3333 12.3333ZM14.3333 8.36667C14.0889 8.25556 13.8667 8.12222 13.6667 7.96667C13.4667 7.81111 13.3667 7.57778 13.3667 7.26667C13.3667 6.95556 13.4667 6.72778 13.6667 6.58333C13.8667 6.43889 14.0889 6.34444 14.3333 6.3V8.36667ZM9.33333 18.6667C6.73333 18.6667 4.52778 17.7611 2.71667 15.95C0.905556 14.1389 0 11.9333 0 9.33333C0 6.73333 0.905556 4.52778 2.71667 2.71667C4.52778 0.905556 6.73333 0 9.33333 0H20C22.6 0 24.8056 0.905556 26.6167 2.71667C28.4278 4.52778 29.3333 6.73333 29.3333 9.33333C29.3333 11.9333 28.4278 14.1389 26.6167 15.95C24.8056 17.7611 22.6 18.6667 20 18.6667H9.33333Z"
      />
      <path
        d="M9.33301 0.200195H20C22.5479 0.200196 24.7026 1.08543 26.4756 2.8584C28.2483 4.63123 29.1337 6.78545 29.1338 9.33301C29.1338 11.8808 28.2484 14.0357 26.4756 15.8086C24.7026 17.5816 22.5479 18.4668 20 18.4668H9.33301C6.78537 18.4667 4.63126 17.5814 2.8584 15.8086C1.08543 14.0356 0.200195 11.8809 0.200195 9.33301C0.200271 6.78529 1.0855 4.6313 2.8584 2.8584C4.6313 1.0855 6.78529 0.200271 9.33301 0.200195Z"
        stroke={soft}
        strokeOpacity="0.3"
        strokeWidth="0.4"
      />
      <defs>
        <clipPath id={clip0}>
          <path d="M14.3333 14.6667H15.3V13.6C15.9222 13.5111 16.45 13.2556 16.8833 12.8333C17.3167 12.4111 17.5333 11.8667 17.5333 11.2C17.5333 10.6222 17.3111 10.1389 16.8667 9.75C16.4222 9.36111 15.9111 9.04444 15.3333 8.8V6.33333C15.5556 6.4 15.7389 6.51111 15.8833 6.66667C16.0278 6.82222 16.1333 7.01111 16.2 7.23333L17.4 6.73333C17.2444 6.26667 16.9778 5.89444 16.6 5.61667C16.2222 5.33889 15.8 5.15556 15.3333 5.06667V4H14.3333V5.03333C13.7111 5.1 13.1833 5.32778 12.75 5.71667C12.3167 6.10556 12.1 6.62222 12.1 7.26667C12.1 7.86667 12.3278 8.36667 12.7833 8.76667C13.2389 9.16667 13.7556 9.48889 14.3333 9.73333V12.3667C13.9778 12.2556 13.6778 12.0667 13.4333 11.8C13.1889 11.5333 13.0222 11.2222 12.9333 10.8667L11.7667 11.3667C11.9444 11.9889 12.2556 12.5 12.7 12.9C13.1444 13.3 13.6889 13.5444 14.3333 13.6333V14.6667ZM15.3333 12.3333V10.1333C15.5778 10.2444 15.7944 10.3778 15.9833 10.5333C16.1722 10.6889 16.2667 10.9222 16.2667 11.2333C16.2667 11.5889 16.1778 11.8389 16 11.9833C15.8222 12.1278 15.6 12.2444 15.3333 12.3333ZM14.3333 8.36667C14.0889 8.25556 13.8667 8.12222 13.6667 7.96667C13.4667 7.81111 13.3667 7.57778 13.3667 7.26667C13.3667 6.95556 13.4667 6.72778 13.6667 6.58333C13.8667 6.43889 14.0889 6.34444 14.3333 6.3V8.36667ZM9.33333 18.6667C6.73333 18.6667 4.52778 17.7611 2.71667 15.95C0.905556 14.1389 0 11.9333 0 9.33333C0 6.73333 0.905556 4.52778 2.71667 2.71667C4.52778 0.905556 6.73333 0 9.33333 0H20C22.6 0 24.8056 0.905556 26.6167 2.71667C28.4278 4.52778 29.3333 6.73333 29.3333 9.33333C29.3333 11.9333 28.4278 14.1389 26.6167 15.95C24.8056 17.7611 22.6 18.6667 20 18.6667H9.33333Z" />
        </clipPath>
      </defs>
    </svg>
  );
}

function TieredIcon({ accent, soft }: { accent: string; soft: string }) {
  const rid = React.useId();
  const clip0 = `rp-tiered-clip0-${rid}`;
  return (
    <svg className="rpTopIcon" xmlns="http://www.w3.org/2000/svg" width="26" height="19" viewBox="0 0 26 19" fill="none">
      <g clipPath={`url(#${clip0})`} data-figma-skip-parse="true">
        <g transform="matrix(0.0045 0.001 -0.000918782 0.00413452 -0.372559 19.6666)">
          <AngularFillBlock accent={accent} soft={soft} />
        </g>
      </g>
      <path
        d="M18.8333 7.66667H7.16667C6.70833 7.66667 6.33333 8.04167 6.33333 8.5V16.3333C6.33333 16.7917 6.70833 17.1667 7.16667 17.1667H18.8333C19.2917 17.1667 19.6667 16.7917 19.6667 16.3333V8.5C19.6667 8.04167 19.2917 7.66667 18.8333 7.66667ZM18.8333 16.3333H7.16667V8.5H18.8333V16.3333Z"
        fill={accent}
      />
      <path
        d="M18.8333 4.83333H7.16667C6.70833 4.83333 6.33333 5.20833 6.33333 5.66667V6.5H19.6667V5.66667C19.6667 5.20833 19.2917 4.83333 18.8333 4.83333Z"
        fill={accent}
      />
      <path
        d="M18.8333 2H7.16667C6.70833 2 6.33333 2.375 6.33333 2.83333V3.66667H19.6667V2.83333C19.6667 2.375 19.2917 2 18.8333 2Z"
        fill={accent}
      />
      <path
        d="M1.16667 18.6667C0.520833 18.6667 0 18.1458 0 17.5V1.16667C0 0.520833 0.520833 0 1.16667 0H24.8333C25.4792 0 26 0.520833 26 1.16667V17.5C26 18.1458 25.4792 18.6667 24.8333 18.6667H1.16667Z"
        stroke={soft}
        strokeOpacity="0.3"
        strokeWidth="0.4"
      />
      <defs>
        <clipPath id={clip0}>
          <path d="M18.8333 7.66667H7.16667C6.70833 7.66667 6.33333 8.04167 6.33333 8.5V16.3333C6.33333 16.7917 6.70833 17.1667 7.16667 17.1667H18.8333C19.2917 17.1667 19.6667 16.7917 19.6667 16.3333V8.5C19.6667 8.04167 19.2917 7.66667 18.8333 7.66667ZM18.8333 16.3333H7.16667V8.5H18.8333V16.3333ZM18.8333 4.83333H7.16667C6.70833 4.83333 6.33333 5.20833 6.33333 5.66667V6.5H19.6667V5.66667C19.6667 5.20833 19.2917 4.83333 18.8333 4.83333ZM18.8333 2H7.16667C6.70833 2 6.33333 2.375 6.33333 2.83333V3.66667H19.6667V2.83333C19.6667 2.375 19.2917 2 18.8333 2Z" />
        </clipPath>
      </defs>
    </svg>
  );
}

function UsageBasedIcon({ accent, soft }: { accent: string; soft: string }) {
  const rid = React.useId();
  const clip0 = `rp-usage-clip0-${rid}`;
  return (
    <svg className="rpTopIcon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 18" fill="none">
      <g clipPath={`url(#${clip0})`} data-figma-skip-parse="true">
        <g transform="matrix(0.00413385 0.000957143 -0.000844024 0.00395733 -0.342245 18.8238)">
          <foreignObject x="-5964.07" y="-5964.07" width="11928.1" height="11928.1">
            <div
              style={{
                background: `conic-gradient(from 90deg, ${hexToRgba(soft, 0.3)} 0deg, ${accent} 242.437deg, ${hexToRgba(soft, 0.3)} 360deg)`,
                height: "100%",
                width: "100%",
                opacity: 1,
              }}
            />
          </foreignObject>
        </g>
      </g>
      <path
        d="M10.0667 13.0667C10.4222 13.4222 10.8944 13.5833 11.4833 13.55C12.0722 13.5167 12.5111 13.3111 12.8 12.9333L17.7687 6.174C17.9451 5.92467 17.9333 5.7 17.7333 5.5C17.5333 5.3 17.3081 5.28767 17.0577 5.463L10.2667 10.4C9.86667 10.6667 9.63889 11.0814 9.58333 11.6443C9.52778 12.207 9.68889 12.6811 10.0667 13.0667ZM2.4 17.8667C2.226 17.8667 2.06578 17.8167 1.91933 17.7167C1.77311 17.6167 1.64444 17.4889 1.53333 17.3333C1.02222 16.4667 0.638889 15.5444 0.383333 14.5667C0.127778 13.5889 0 12.6 0 11.6C0 9.99533 0.304444 8.48733 0.913333 7.076C1.52244 5.66467 2.349 4.437 3.393 3.393C4.437 2.349 5.66467 1.52255 7.076 0.913666C8.48733 0.304555 9.99533 0 11.6 0C13.1984 0 14.6996 0.299556 16.1033 0.898667C17.5069 1.498 18.735 2.31467 19.7877 3.34867C20.8403 4.38289 21.6722 5.59444 22.2833 6.98333C22.8944 8.37222 23.2 9.86467 23.2 11.4607C23.2 12.5313 23.0722 13.5667 22.8167 14.5667C22.5611 15.5667 22.1778 16.5333 21.6667 17.4667C21.5778 17.6222 21.4567 17.7278 21.3033 17.7833C21.15 17.8389 20.9822 17.8667 20.8 17.8667H2.4Z"
        fill="url(#none)" // keep fill from figma block (clipped foreignObject)
      />
      <path
        d="M11.5996 0.200195C13.1723 0.200195 14.6467 0.495046 16.0244 1.08301C17.4058 1.67287 18.6132 2.47533 19.6475 3.49121C20.6814 4.50708 21.4994 5.69725 22.1006 7.06348C22.7 8.42567 23 9.89121 23 11.4609C23 12.5154 22.8743 13.5344 22.623 14.5176C22.3721 15.4995 21.9955 16.4493 21.4932 17.3672C21.4253 17.4859 21.3396 17.5579 21.2354 17.5957C21.1063 17.6425 20.9615 17.667 20.7998 17.667H2.40039C2.30078 17.667 2.20739 17.6458 2.11914 17.6025L2.03223 17.5518C1.90888 17.4674 1.79857 17.3585 1.70117 17.2236C1.20185 16.3753 0.827263 15.4726 0.577148 14.5156C0.325925 13.5543 0.200195 12.5822 0.200195 11.5996C0.200245 10.0212 0.49915 8.54033 1.09668 7.15527C1.6962 5.76617 2.50878 4.55958 3.53418 3.53418C4.55955 2.50881 5.76622 1.69694 7.15527 1.09766C8.54037 0.499869 10.0211 0.200245 11.5996 0.200195ZM17.4258 5.14062C17.2551 5.13128 17.0922 5.19472 16.9434 5.29883L16.9404 5.30078L10.1553 10.2334C9.6965 10.5393 9.44504 11.0143 9.38477 11.625C9.32379 12.2432 9.50249 12.777 9.92383 13.207L9.9248 13.208C10.3277 13.6109 10.8602 13.7859 11.4951 13.75C12.1268 13.7141 12.6264 13.4896 12.959 13.0547L12.9609 13.0518L17.9297 6.29199L17.9316 6.28906C18.0365 6.14078 18.1008 5.97849 18.0918 5.80762C18.0826 5.63436 18.0005 5.48391 17.875 5.3584C17.7494 5.23285 17.599 5.15023 17.4258 5.14062Z"
        stroke={soft}
        strokeOpacity="0.3"
        strokeWidth="0.4"
      />
      <defs>
        <clipPath id={clip0}>
          <path d="M10.0667 13.0667C10.4222 13.4222 10.8944 13.5833 11.4833 13.55C12.0722 13.5167 12.5111 13.3111 12.8 12.9333L17.7687 6.174C17.9451 5.92467 17.9333 5.7 17.7333 5.5C17.5333 5.3 17.3081 5.28767 17.0577 5.463L10.2667 10.4C9.86667 10.6667 9.63889 11.0814 9.58333 11.6443C9.52778 12.207 9.68889 12.6811 10.0667 13.0667ZM2.4 17.8667C2.226 17.8667 2.06578 17.8167 1.91933 17.7167C1.77311 17.6167 1.64444 17.4889 1.53333 17.3333C1.02222 16.4667 0.638889 15.5444 0.383333 14.5667C0.127778 13.5889 0 12.6 0 11.6C0 9.99533 0.304444 8.48733 0.913333 7.076C1.52244 5.66467 2.349 4.437 3.393 3.393C4.437 2.349 5.66467 1.52255 7.076 0.913666C8.48733 0.304555 9.99533 0 11.6 0C13.1984 0 14.6996 0.299556 16.1033 0.898667C17.5069 1.498 18.735 2.31467 19.7877 3.34867C20.8403 4.38289 21.6722 5.59444 22.2833 6.98333C22.8944 8.37222 23.2 9.86467 23.2 11.4607C23.2 12.5313 23.0722 13.5667 22.8167 14.5667C22.5611 15.5667 22.1778 16.5333 21.6667 17.4667C21.5778 17.6222 21.4567 17.7278 21.3033 17.7833C21.15 17.8389 20.9822 17.8667 20.8 17.8667H2.4Z" />
        </clipPath>
      </defs>
    </svg>
  );
}

function VolumeBasedIcon({ accent, soft }: { accent: string; soft: string }) {
  const rid = React.useId();
  const clip0 = `rp-volume-clip0-${rid}`;
  const clip1 = `rp-volume-clip1-${rid}`;
  return (
    <svg className="rpTopIcon" xmlns="http://www.w3.org/2000/svg" width="26" height="19" viewBox="0 0 26 19" fill="none">
      <g clipPath={`url(#${clip0})`} data-figma-skip-parse="true">
        <g transform="matrix(0.00457337 0.001 -0.000933763 0.00413452 -0.378633 19.6666)">
          <foreignObject x="-5957.8" y="-5957.8" width="11915.6" height="11915.6">
            <div
              style={{
                background: `conic-gradient(from 90deg, ${hexToRgba(soft, 0.3)} 0deg, ${accent} 242.437deg, ${hexToRgba(soft, 0.3)} 360deg)`,
                height: "100%",
                width: "100%",
                opacity: 1,
              }}
            />
          </foreignObject>
        </g>
      </g>
      <path
        d="M14.1118 1.18385V5.82398H24.3396C24.7496 5.82398 25.0733 5.94871 25.3106 6.19818C25.548 6.44765 25.6667 6.72207 25.6667 7.02143C25.6667 7.22101 25.6127 7.41559 25.5048 7.60519C25.3969 7.79479 25.2243 7.94946 24.987 8.0692L14.0471 13.5775C13.6587 13.7771 13.2487 13.8769 12.8172 13.8769C12.3856 13.8769 11.9756 13.7771 11.5872 13.5775L0.647331 8.0692C0.409976 7.94946 0.242749 7.79978 0.145649 7.62016C0.0485498 7.44054 0 7.24096 0 7.02143C0 6.8019 0.0485498 6.60232 0.145649 6.4227C0.242749 6.24309 0.409976 6.0934 0.647331 5.97366L12.2022 0.136074C12.418 0.0362865 12.6445 -0.00861804 12.8819 0.00136074C13.1192 0.0113395 13.3242 0.0662228 13.4968 0.166011C13.6695 0.265798 13.8151 0.405501 13.9338 0.585119C14.0525 0.764737 14.1118 0.964313 14.1118 1.18385ZM12.8172 16.2718L22.9802 11.1526C23.0234 11.1327 23.2284 11.0828 23.5952 11.003C23.962 11.003 24.2695 11.1177 24.5177 11.3472C24.7658 11.5767 24.8899 11.8611 24.8899 12.2004C24.8899 12.4199 24.8359 12.6195 24.728 12.7991C24.6201 12.9788 24.4475 13.1284 24.2102 13.2482L14.0471 18.3673C13.8529 18.4671 13.6533 18.5419 13.4483 18.5918C13.2433 18.6417 13.0329 18.6667 12.8172 18.6667C12.6014 18.6667 12.391 18.6417 12.186 18.5918C11.981 18.5419 11.7814 18.4671 11.5872 18.3673L1.42413 13.2482C1.18677 13.1284 1.01415 12.9788 0.906263 12.7991C0.798375 12.6195 0.74443 12.4199 0.74443 12.2004C0.74443 11.8611 0.868502 11.5767 1.11665 11.3472C1.36479 11.1177 1.67227 11.003 2.03909 11.003C2.14698 11.003 2.24947 11.0179 2.34657 11.0479C2.44367 11.0778 2.54617 11.1127 2.65406 11.1526L12.8172 16.2718Z"
        fill="url(#none)" // keep fill from figma block (clipped foreignObject)
      />
      <g clipPath={`url(#${clip1})`} data-figma-skip-parse="true">
        <g transform="matrix(0.00457337 0.001 -0.000933763 0.00413452 -0.378633 19.6666)">
          <foreignObject x="-5957.8" y="-5957.8" width="11915.6" height="11915.6">
            <div
              style={{
                background: `conic-gradient(from 90deg, ${hexToRgba(soft, 0.3)} 0deg, ${accent} 242.437deg, ${hexToRgba(soft, 0.3)} 360deg)`,
                height: "100%",
                width: "100%",
                opacity: 1,
              }}
            />
          </foreignObject>
        </g>
      </g>
      <path
        d="M25.1027 6.01946L13.3374 0.130408L11.1873 6.97832L17.0133 9.37323L25.1027 6.01946Z"
        fill="url(#none)" // keep fill from figma block (clipped foreignObject)
      />
      <path
        d="M2.03906 11.2031C2.12821 11.2031 2.21122 11.2156 2.28809 11.2393C2.37822 11.2671 2.4741 11.2987 2.5752 11.3359L12.7275 16.4502L12.8174 16.4961L12.9072 16.4502L23.0645 11.334C23.0588 11.3366 23.0645 11.3333 23.0967 11.3242C23.1244 11.3164 23.1637 11.3071 23.2139 11.2949C23.3093 11.2717 23.4418 11.2404 23.6123 11.2031C23.9255 11.2066 24.1777 11.3053 24.3818 11.4941C24.5888 11.6856 24.6894 11.9165 24.6895 12.2002C24.6895 12.3853 24.6449 12.5493 24.5566 12.6963C24.4938 12.8008 24.3994 12.898 24.2666 12.9854L24.1201 13.0693L13.957 18.1885L13.9561 18.1895C13.7755 18.2822 13.5904 18.3514 13.4014 18.3975C13.2123 18.4435 13.0175 18.4668 12.8174 18.4668C12.6172 18.4668 12.4225 18.4435 12.2334 18.3975C12.0443 18.3514 11.8594 18.2823 11.6787 18.1895L11.6768 18.1885L1.51465 13.0693C1.30216 12.9621 1.16199 12.8358 1.07812 12.6963C0.989829 12.5493 0.944336 12.3853 0.944336 12.2002C0.944388 11.9165 1.04594 11.6856 1.25293 11.4941C1.46077 11.302 1.71804 11.2031 2.03906 11.2031ZM12.873 0.201172C12.9527 0.204519 13.0268 0.215315 13.0957 0.229492L10.9961 6.91797L10.9414 7.09375L11.1113 7.16309L16.9375 9.55859L17.0137 9.58984L17.0898 9.55762L25.0693 6.24902C25.1031 6.27603 25.136 6.30436 25.166 6.33594C25.3737 6.55421 25.4668 6.78121 25.4668 7.02148C25.4668 7.18307 25.4233 7.34365 25.3311 7.50586C25.2465 7.6544 25.1065 7.7847 24.8965 7.89062L13.957 13.3984L13.9561 13.3994C13.5957 13.5846 13.2167 13.6767 12.8174 13.6768C12.418 13.6768 12.0392 13.5846 11.6787 13.3994L11.6768 13.3984L0.737305 7.89062C0.525613 7.78381 0.393862 7.65956 0.321289 7.52539C0.241167 7.37718 0.200203 7.21035 0.200195 7.02148C0.200195 6.83259 0.241159 6.6658 0.321289 6.51758C0.393848 6.38339 0.525595 6.25918 0.737305 6.15234L12.2861 0.317383C12.4729 0.231033 12.6677 0.192605 12.873 0.201172ZM13.5791 0.474609C13.6475 0.537387 13.7104 0.610256 13.7666 0.695312C13.8632 0.841475 13.9121 1.00255 13.9121 1.18359V6.02441H24.3398C24.4095 6.02442 24.4755 6.02832 24.5381 6.03613L17.0117 9.15625L11.4326 6.8623L13.457 0.414062L13.5791 0.474609ZM14.3115 1.18359C14.3115 1.05568 14.2934 0.932941 14.2588 0.81543L23.8652 5.62402H14.3115V1.18359Z"
        stroke={soft}
        strokeOpacity="0.3"
        strokeWidth="0.4"
      />
      <defs>
        <clipPath id={clip0}>
          <path d="M14.1118 1.18385V5.82398H24.3396C24.7496 5.82398 25.0733 5.94871 25.3106 6.19818C25.548 6.44765 25.6667 6.72207 25.6667 7.02143C25.6667 7.22101 25.6127 7.41559 25.5048 7.60519C25.3969 7.79479 25.2243 7.94946 24.987 8.0692L14.0471 13.5775C13.6587 13.7771 13.2487 13.8769 12.8172 13.8769C12.3856 13.8769 11.9756 13.7771 11.5872 13.5775L0.647331 8.0692C0.409976 7.94946 0.242749 7.79978 0.145649 7.62016C0.0485498 7.44054 0 7.24096 0 7.02143C0 6.8019 0.0485498 6.60232 0.145649 6.4227C0.242749 6.24309 0.409976 6.0934 0.647331 5.97366L12.2022 0.136074C12.418 0.0362865 12.6445 -0.00861804 12.8819 0.00136074C13.1192 0.0113395 13.3242 0.0662228 13.4968 0.166011C13.6695 0.265798 13.8151 0.405501 13.9338 0.585119C14.0525 0.764737 14.1118 0.964313 14.1118 1.18385ZM12.8172 16.2718L22.9802 11.1526C23.0234 11.1327 23.2284 11.0828 23.5952 11.003C23.962 11.003 24.2695 11.1177 24.5177 11.3472C24.7658 11.5767 24.8899 11.8611 24.8899 12.2004C24.8899 12.4199 24.8359 12.6195 24.728 12.7991C24.6201 12.9788 24.4475 13.1284 24.2102 13.2482L14.0471 18.3673C13.8529 18.4671 13.6533 18.5419 13.4483 18.5918C13.2433 18.6417 13.0329 18.6667 12.8172 18.6667C12.6014 18.6667 12.391 18.6417 12.186 18.5918C11.981 18.5419 11.7814 18.4671 11.5872 18.3673L1.42413 13.2482C1.18677 13.1284 1.01415 12.9788 0.906263 12.7991C0.798375 12.6195 0.74443 12.4199 0.74443 12.2004C0.74443 11.8611 0.868502 11.5767 1.11665 11.3472C1.36479 11.1177 1.67227 11.003 2.03909 11.003C2.14698 11.003 2.24947 11.0179 2.34657 11.0479C2.44367 11.0778 2.54617 11.1127 2.65406 11.1526L12.8172 16.2718Z" />
        </clipPath>
        <clipPath id={clip1}>
          <path d="M25.1027 6.01946L13.3374 0.130408L11.1873 6.97832L17.0133 9.37323L25.1027 6.01946Z" />
        </clipPath>
      </defs>
    </svg>
  );
}

function TopIconByType({ type, accent, soft }: { type: RatePlanIconType; accent: string; soft: string }) {
  switch (type) {
    case "STAIRSTEP":
      return <StairStepIcon accent={accent} soft={soft} />;
    case "FLAT_FEE":
      return <FlatFeeIcon accent={accent} soft={soft} />;
    case "TIERED":
      return <TieredIcon accent={accent} soft={soft} />;
    case "USAGE_BASED":
      return <UsageBasedIcon accent={accent} soft={soft} />;
    case "VOLUME_BASED":
      return <VolumeBasedIcon accent={accent} soft={soft} />;
    default:
      return <StairStepIcon accent={accent} soft={soft} />;
  }
}

export default function RatePlanIconTile({
  type,
  tagText = "IPP",
  size = 80,
  theme,
  className = "",
}: Props) {
  const accent = theme.accent;
  const soft = theme.soft;

  const pillBgAlpha = theme.pillBgAlpha ?? 0.14;
  const pillBg = hexToRgba(accent, pillBgAlpha);
  const pillFg = theme.pillFg ?? accent;

  return (
    <div
      className={`rpTile ${className}`}
      style={
        {
          ["--rp-size" as any]: `${size}px`,
          ["--rp-accent" as any]: accent,
          ["--rp-accent-rgb" as any]: hexToRgb(accent),
          ["--rp-soft" as any]: soft,
          ["--rp-pill-bg" as any]: pillBg,
          ["--rp-pill-fg" as any]: pillFg,
        } as React.CSSProperties
      }
    >
      <div className="rpIconWrap">
        <TopIconByType type={type} accent={accent} soft={soft} />
      </div>

      <div className="rpPill" style={{ color: pillFg }}>
        <svg xmlns="http://www.w3.org/2000/svg" width="8" height="8" viewBox="0 0 8 8" fill="none">
          <path d="M3.74795 0.702293C3.87739 0.572805 4.05298 0.500039 4.23607 0.5L6.71192 0.5C6.89503 0.5 7.07065 0.572741 7.20012 0.70222C7.3296 0.831699 7.40234 1.00731 7.40234 1.19042V3.66627C7.4023 3.84937 7.32954 4.02495 7.20005 4.1544L4.19534 7.15911C4.03844 7.31502 3.82622 7.40253 3.60503 7.40253C3.38383 7.40253 3.17162 7.31502 3.01472 7.15911L0.743234 4.88762C0.587322 4.73072 0.499815 4.51851 0.499815 4.29731C0.499815 4.07612 0.587322 3.86391 0.743234 3.70701L3.74795 0.702293Z" stroke="currentColor" strokeWidth="0.99995" strokeLinecap="round" strokeLinejoin="round"/>
        </svg>
        <span className="rpPillText">{tagText}</span>
      </div>
    </div>
  );
}

/** Optional: your vertical rail */
export function RatePlanIconRail() {
  const blueTheme = { accent: "#2A559C", soft: "#ADC5EB" };

  return (
    <div className="rpRail">
      <RatePlanIconTile type="STAIRSTEP" theme={blueTheme} tagText="IPP" />
      <RatePlanIconTile type="FLAT_FEE" theme={blueTheme} tagText="IPP" />
      <RatePlanIconTile type="TIERED" theme={blueTheme} tagText="IPP" />
      <RatePlanIconTile type="USAGE_BASED" theme={blueTheme} tagText="IPP" />
      <RatePlanIconTile type="VOLUME_BASED" theme={blueTheme} tagText="IPP" />
    </div>
  );
}
